# In tests run the worker with test flags
build --@rules_jvm//:jvm-builder-jvm_flags=//:jvm-inc-builder-test_jvm_flags

# https://bazel.build/docs/bazel-and-java#hermetic-testing
# The code is compiled for, executed, and tested on this JVM.
build --java_language_version=21
build --java_runtime_version=remotejdk_21

# https://bazel.build/docs/bazel-and-java#config-build-tools-java
# A second pair of JDK and JVM used to build and execute tools, which are used in the build process, but are not in the build results.
# That JDK and JVM are controlled using --tool_java_language_version and --tool_java_runtime_version
build --tool_java_language_version=21
# Java runtime the tools should use
build --tool_java_runtime_version=remotejdk_21

common --@rules_jvm//:koltin_inc_threshold=0 --@rules_jvm//:java_inc_threshold=0

# make sure you don't need to open file to read compilation errors
common --experimental_ui_max_stdouterr_bytes=-1

# disable deprecated WORKSPACE support
common --noenable_workspace

# rules_kotlin Compiling Kotlin on Windows appears to require --legacy_external_runfiles https://github.com/bazelbuild/rules_kotlin/issues/1309
# Otherwise it fails with
# LAUNCHER ERROR: Rlocation failed on _main/external/rules_kotlin++rules_kotlin_extensions+com_github_jetbrains_kotlin_git/lib/annotations-13.0.jar, path doesn't exist in MANIFEST file
# also see
# https://github.com/bazelbuild/rules_kotlin/issues/1300
common --legacy_external_runfiles

common --symlink_prefix=/
common --incompatible_enable_proto_toolchain_resolution

# Use target platform short name (not CPU) in the output directory
common --experimental_platform_in_output_dir

# Do not depend on external environment
build --action_env BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
