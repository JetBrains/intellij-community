/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

apply plugin: 'objective-c'

task installLib(type: Copy, group: "Custom", description: "Copies built library to the binaries directory") {
    from "${buildDir}/libs/nst/shared"
    into "${projectDir}/../../bin/mac"
    rename { String fileName ->
	  	fileName.replace("libnst.dylib", "libnst64.dylib")
	}
}
build.finalizedBy(installLib)

model {
    platforms {
        x64 {
            architecture "x64"
        }
        // TODO:
        // need check whether touchbar presented on 32-bit
        // enable release-build
    }

    components {
            nst(NativeLibrarySpec) {
	            sources {
	                objc {
	                    source {
	                        srcDirs "src"
	                    }
	                }
	            }
	            binaries.all {
                    if (targetPlatform.operatingSystem.macOsX) {
                        cCompiler.args '-framework', 'Foundation'
                        linker.args '-framework', "Cocoa"
                    } else {
                    	throw new GradleException("Unsupported platform")
                	}
	            }
	        }
	    }
	}
